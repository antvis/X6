{"version":3,"sources":["node_modules/@antv/dumi-theme-antv/dist/slots/Feedback/SectionFeedback.js"],"sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { styled } from 'styled-components';\nimport { useSnapshot } from 'valtio';\nimport { feedbackStore, invokeSectionFeedback, resetSectionFeedback } from \"../../model/feedback\";\nimport { SectionFeedbackCommentForm } from \"./SectionFeedbackCommentForm\";\nvar StyledWrapper = styled.div.withConfig({\n  displayName: \"StyledWrapper\",\n  componentId: \"dumi-theme-antv-c7ef__sc-vcamqv-0\"\n})([\"background-color:#fff;border-radius:12px;box-shadow:0 0.5rem 1.2rem #f0f1f2;transition:height 0.3s ease-in-out;width:262px;position:fixed;z-index:1001;padding:10px 18px;border-radius:8px;transition:top 0.3s ease-in-out,right 0.3s ease-in-out;\"]);\nvar SectionFeedback = function SectionFeedback() {\n  var feedbackState = useSnapshot(feedbackStore);\n  var location = useLocation();\n  useEffect(function () {\n    var observer = new MutationObserver(function () {\n      var buttons = document.querySelectorAll('.comment-link');\n      if (!buttons || buttons.length === 0) return;\n      var focusCommentInput = function focusCommentInput(e) {\n        var button = e.target.closest('.comment-link');\n        invokeSectionFeedback(button.getAttribute('data-feedback-hash'));\n      };\n      buttons.forEach(function (button) {\n        button.addEventListener('click', focusCommentInput);\n      });\n      return function () {\n        buttons.forEach(function (button) {\n          button.removeEventListener('click', focusCommentInput);\n        });\n      };\n    });\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n    return function () {\n      observer.disconnect();\n    };\n  }, []);\n  var _useState = useState({\n      top: 0,\n      right: 12\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    position = _useState2[0],\n    setPosition = _useState2[1];\n  useEffect(function () {\n    var handleClick = function handleClick(e) {\n      var target = e.target;\n      var closestCommentLink = target.closest('.comment-link');\n      if (!feedbackState.section || !closestCommentLink) return;\n      var escapedSection = CSS.escape(feedbackState.section);\n      var elements = document.querySelectorAll(\".comment-link[data-feedback-hash=\".concat(escapedSection, \"]\"));\n      var closestElement = findClosetElement(e, elements);\n      if (closestElement) {\n        var rect = closestElement.getBoundingClientRect();\n        var top = Math.min(Math.max(rect.top, 0), window.innerHeight - 380);\n        setPosition({\n          top: top,\n          right: 12\n        });\n      }\n    };\n    window.addEventListener('click', handleClick);\n    return function () {\n      window.removeEventListener('click', handleClick);\n    };\n  }, [feedbackState.section]);\n  useEffect(function () {\n    resetSectionFeedback();\n  }, [location.pathname]);\n  if (!feedbackState.section) return null;\n  return /*#__PURE__*/React.createElement(StyledWrapper, {\n    style: {\n      top: position.top,\n      right: position.right\n    }\n  }, /*#__PURE__*/React.createElement(SectionFeedbackCommentForm, null));\n};\nvar findClosetElement = function findClosetElement(e, elements) {\n  var closestElement = null;\n  var closestDistance = Infinity;\n  elements.forEach(function (element) {\n    var rect = element.getBoundingClientRect();\n    var distance = Math.sqrt(Math.pow(rect.left + rect.width / 2 - e.clientX, 2) + Math.pow(rect.top + rect.height / 2 - e.clientY, 2));\n    if (distance < closestDistance) {\n      closestDistance = distance;\n      closestElement = element;\n    }\n  });\n  return closestElement;\n};\nexport default SectionFeedback;"],"names":[],"mappings":"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"}